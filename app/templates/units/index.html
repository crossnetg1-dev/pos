{% extends "base.html" %}

{% block title %}Units | Smart POS{% endblock %}

{% block content %}
<div class="container-fluid px-0">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">Unit Management</h4>
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addUnitModal">
      <i class="fa fa-plus me-1"></i>Add New Unit
    </button>
  </div>

  <div class="card border-0 shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Short Name</th>
              <th class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% if units %}
              {% for unit in units %}
              <tr>
                <td>{{ unit.id }}</td>
                <td><strong>{{ unit.name }}</strong></td>
                <td><code>{{ unit.short_name }}</code></td>
                <td class="text-center">
                  <button class="btn btn-sm btn-outline-primary me-1 edit-unit" 
                          data-unit-id="{{ unit.id }}"
                          data-unit-name="{{ unit.name }}"
                          data-unit-short="{{ unit.short_name }}">
                    <i class="fa fa-edit"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger delete-unit" 
                          data-unit-id="{{ unit.id }}"
                          data-unit-name="{{ unit.name }}">
                    <i class="fa fa-trash"></i>
                  </button>
                </td>
              </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="4" class="text-center text-muted py-4">No units found. Add your first unit above.</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Add Unit Modal -->
<div class="modal fade" id="addUnitModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New Unit</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form method="POST" action="{{ url_for('units.add') }}">
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Unit Name <span class="text-danger">*</span></label>
            <input type="text" name="name" class="form-control" placeholder="e.g., Kilogram, Piece" required autofocus>
            <small class="text-muted">Full name of the unit</small>
          </div>
          <div class="mb-3">
            <label class="form-label">Short Name <span class="text-danger">*</span></label>
            <input type="text" name="short_name" class="form-control" placeholder="e.g., kg, pcs" required maxlength="10">
            <small class="text-muted">Abbreviation (max 10 characters)</small>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Add Unit</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Edit Unit Modal -->
<div class="modal fade" id="editUnitModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Unit</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="editUnitForm" method="POST">
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Unit Name <span class="text-danger">*</span></label>
            <input type="text" name="name" id="editUnitName" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Short Name <span class="text-danger">*</span></label>
            <input type="text" name="short_name" id="editUnitShort" class="form-control" required maxlength="10">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Update Unit</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
  // Edit Unit
  document.querySelectorAll('.edit-unit').forEach(btn => {
    btn.addEventListener('click', function() {
      const unitId = this.dataset.unitId;
      const unitName = this.dataset.unitName;
      const unitShort = this.dataset.unitShort;
      
      document.getElementById('editUnitName').value = unitName;
      document.getElementById('editUnitShort').value = unitShort;
      document.getElementById('editUnitForm').action = `/units/edit/${unitId}`;
      
      const modal = new bootstrap.Modal(document.getElementById('editUnitModal'));
      modal.show();
    });
  });

  // Delete Unit
  document.querySelectorAll('.delete-unit').forEach(btn => {
    btn.addEventListener('click', function() {
      const unitId = this.dataset.unitId;
      const unitName = this.dataset.unitName;
      
      if (confirm(`Are you sure you want to delete "${unitName}"? Products using this unit will be set to "No Unit".`)) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/units/delete/${unitId}`;
        document.body.appendChild(form);
        form.submit();
      }
    });
  });
</script>
{% endblock %}
